
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>System Diagram - CosyWorld Documentation</title>
  <!-- Mermaid script for diagram rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      mermaid.initialize({ 
        startOnLoad: true,
        theme: 'dark',
        securityLevel: 'loose'
      });
    });
  </script>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
      line-height: 1.6;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
      display: flex;
    }
    nav {
      width: 250px;
      padding-right: 2rem;
      flex-shrink: 0;
    }
    main {
      flex-grow: 1;
    }
    code {
      background: #f5f5f5;
      padding: 0.2em 0.4em;
      border-radius: 3px;
      font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      font-size: 85%;
    }
    pre {
      background: #f5f5f5;
      padding: 1rem;
      border-radius: 5px;
      overflow: auto;
    }
    pre code {
      background: none;
      padding: 0;
    }
    a { color: #0366d6; text-decoration: none; }
    a:hover { text-decoration: underline; }
    h1, h2, h3, h4 { margin-top: 1.5em; margin-bottom: 0.5em; }
    h1 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
    nav ul { list-style-type: none; padding-left: 1.2em; }
    nav > ul { padding-left: 0; }
    .section-title { 
      font-weight: bold; 
      margin-top: 1em;
      color: #24292e;
    }
    /* Mermaid diagram styling */
    .mermaid {
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <nav><ul><li><a href="../index.html">Home</a></li><li><span class="section-title">Overview</span><ul><li><a href="../overview/03-system-diagram.html">System Diagram</a></li><li><a href="../overview/02-system-overview.html">System Overview</a></li><li><a href="../overview/01-introduction.html">CosyWorld Introduction</a></li></ul></li><li><span class="section-title">Systems</span><ul><li><a href="../systems/06-dungeon-system.html">Dungeon System</a></li><li><a href="../systems/05-intelligence-system.html">Intelligence System</a></li><li><a href="../systems/04-action-system.html">Action System</a></li></ul></li><li><span class="section-title">Services</span><ul><li><a href="../services/architecture-report.html">CosyWorld Architecture Report</a></li><li><a href="../services/README.html">CosyWorld Services Documentation</a></li><li><span class="section-title">Web</span><ul><li><a href="../services/web/webService.html">Web Service</a></li></ul></li><li><span class="section-title">Tools</span><ul><li><a href="../services/tools/toolService.html">Tool Service</a></li></ul></li><li><span class="section-title">S3</span><ul><li><a href="../services/s3/s3Service.html">S3 Service</a></li></ul></li><li><span class="section-title">Quest</span><ul><li><a href="../services/quest/questGeneratorService.html">Quest Generator Service</a></li></ul></li><li><span class="section-title">Location</span><ul><li><a href="../services/location/locationService.html">Location Service</a></li></ul></li><li><span class="section-title">Item</span><ul><li><a href="../services/item/itemService.html">Item Service</a></li></ul></li><li><span class="section-title">Core</span><ul><li><a href="../services/core/promptService.html">Prompt Service</a></li><li><a href="../services/core/memoryService.html">Memory Service</a></li><li><a href="../services/core/databaseService.html">Database Service</a></li><li><a href="../services/core/basicService.html">Basic Service</a></li><li><a href="../services/core/avatarService.html">Avatar Service</a></li><li><a href="../services/core/aiService.html">AI Service</a></li></ul></li><li><span class="section-title">Chat</span><ul><li><a href="../services/chat/conversationManager.html">Conversation Manager</a></li></ul></li></ul></li><li><span class="section-title">Deployment</span><ul><li><a href="../deployment/08-future-work.html">Future Work Priorities</a></li><li><a href="../deployment/07-deployment.html">Deployment Guide</a></li></ul></li></ul></nav>
  <main><h1>System Diagram</h1>
<h2>System Architecture (Flowchart)</h2>
<p>This diagram provides a high-level overview of the system’s core components and their interconnections.</p>
<p>It illustrates how the <strong>Platform Bots</strong> interface with external APIs, how the <strong>Core Services</strong> process and manage data, and how these services interact with Storage and AI providers. The diagram shows the system’s layered architecture and primary data flow paths.</p>
<div class="mermaid">
flowchart TD
    subgraph PB["Platform Bots"]
        DS[Discord Bot]:::blue
        TB[Telegram Bot]:::blue
        XB[X Bot]:::blue
    end
    subgraph PA["Platform APIs"]
        DISCORD[Discord]:::gold
        TG[Telegram]:::gold
        X[Twitter]:::gold
    end
    subgraph CS["Core Services"]
        CHAT[Chat Service]:::green
        MS[Memory Service]:::green
        AS[Avatar Service]:::green
        AIS[AI Service]:::green
        TS[Tool Service]:::green
        LS[Location Service]:::green
        CS[Creation Service]:::green
    end
    subgraph SL["Storage Layer"]
        MONGO[MongoDB]:::brown
        S3[S3 Storage]:::brown
        ARW[Arweave]:::brown
    end
    subgraph AI["AI Services"]
        OR[OpenRouter]:::gold
        GAI[Google AI]:::gold
        REP[Replicate]:::gold
    end
    DS --> DISCORD
    TB --> TG
    XB --> X
    DS --> CHAT
    TB --> CHAT
    XB --> CHAT
    CHAT --> MS
    CHAT --> AS
    CHAT --> AIS
    CHAT --> TS
    TS --> LS
    AS --> CS
    AIS --> OR
    AIS --> GAI
    CS --> REP
    MS --> MONGO
    TS --> MONGO
    LS --> MONGO
    AS --> S3
    AS --> ARW
    CS --> S3
    classDef blue fill:#1a5f7a,stroke:#666,color:#fff
    classDef green fill:#145a32,stroke:#666,color:#fff
    classDef brown fill:#5d4037,stroke:#666,color:#fff
    classDef gold fill:#7d6608,stroke:#666,color:#fff
    style PB fill:#1a1a1a,stroke:#666,color:#fff
    style PA fill:#1a1a1a,stroke:#666,color:#fff
    style CS fill:#1a1a1a,stroke:#666,color:#fff
    style SL fill:#1a1a1a,stroke:#666,color:#fff
    style AI fill:#1a1a1a,stroke:#666,color:#fff
</div>
<h2>Message Flow (Sequence Diagram)</h2>
<p>This sequence diagram tracks the lifecycle of a user message through the system.</p>
<p>It demonstrates the interaction between different services, showing how a message flows from initial user input to final response. Each message is enriched with historical context from memory, can trigger media generation, and gets archived for future reference. The diagram illustrates how our services work together in real-time, handling everything from chat responses to image creation and data storage.</p>
<p><strong>Key Features</strong></p>
<ul>
<li>Message routing connects our agents to users across different platforms</li>
<li>Context from past conversations informs responses</li>
<li>AI services generate natural, contextual replies</li>
<li>Dynamic creation of images and media</li>
<li>Persistent memory storage for future context</li>
<li>Real-time processing and response delivery</li>
</ul>
<div class="mermaid">
sequenceDiagram
    participant U as User
    participant B as Platform Bot
    participant C as Chat Service
    participant M as Memory Service
    participant A as Avatar Service
    participant AI as AI Service
    participant CR as Creation Service
    participant S as Storage
    U->>B: Send Message
    B->>C: Route Message
    rect rgb(40, 40, 40)
        note right of C: Context Loading
        C->>M: Get Context
        M->>S: Fetch History
        S-->>M: Return History
        M-->>C: Return Context
    end
    rect rgb(40, 40, 40)
        note right of C: Response Generation
        C->>AI: Generate Response
        alt Content Generation
            AI->>CR: Generate Content
            CR->>A: Create Entity
            A->>S: Store Entity
            S-->>A: Return Reference
            A-->>CR: Entity Details
            CR-->>AI: Generated Content
        end
        AI-->>C: Complete Response
    end
    rect rgb(40, 40, 40)
        note right of C: Memory Storage
        C->>M: Store Interaction
        M->>S: Save Memory
        alt Memory Milestone
            M->>S: Archive to Chain
        end
    end
    C-->>B: Send Response
    B-->>U: Display Message
</div></main>
</body>
</html>
