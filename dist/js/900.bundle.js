(self.webpackChunkmoonstone_sanctum=self.webpackChunkmoonstone_sanctum||[]).push([[900],{900:(t,e,r)=>{r.r(e),r.d(e,{default:()=>s});const o="/api/xauth",s=new class{async initiateXAuth(t){try{const e=await fetch(`${o}/status/${t}`);if((await e.json()).authorized)return confirm("This avatar is already connected to X. Do you want to disconnect it?")?this.disconnectXAuth(t):{success:!1,error:"Operation cancelled"};const r=await fetch(`${o}/initiate/${t}`,{method:"POST",headers:{"Content-Type":"application/json"}}),s=await r.json();if(s.authUrl){const t=window.open(s.authUrl,"xauth","width=600,height=800,status=yes,scrollbars=yes");if(!t||t.closed||void 0===t.closed)throw new Error("Popup blocked! Please allow popups for this website.");return{success:!0,popup:t}}throw new Error(s.error||"Failed to initiate X authorization")}catch(t){return console.error("X Auth Error:",t),{success:!1,error:t.message}}}async disconnectXAuth(t){try{const e=await fetch(`${o}/disconnect/${t}`,{method:"POST",headers:{"Content-Type":"application/json"}}),r=await e.json();if(r.success)return{success:!0};throw new Error(r.error||"Failed to disconnect X authorization")}catch(t){return console.error("X Disconnect Error:",t),{success:!1,error:t.message}}}async checkXAuthStatus(t){try{const e=await fetch(`${o}/status/${t}`),r=await e.json();return{success:!0,authorized:r.authorized||!1,requiresReauth:r.requiresReauth||!1,expiresAt:r.expiresAt,error:r.error}}catch(t){return console.error("X Status Check Error:",t),{success:!1,authorized:!1,error:t.message}}}async postToX(t,e){try{const r=await this.checkXAuthStatus(t);if(!r.authorized)throw new Error("This avatar is not authorized to post to X");if(r.requiresReauth)throw new Error("X authorization expired. Please reconnect.");const s=await fetch(`${o}/post/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})}),a=await s.json();if(a.success)return{success:!0,tweetId:a.tweetId,tweetUrl:a.tweetUrl};throw new Error(a.error||"Failed to post to X")}catch(t){return console.error("X Post Error:",t),{success:!1,error:t.message}}}}}}]);