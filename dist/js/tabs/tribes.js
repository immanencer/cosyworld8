import{TribesAPI}from"../core/api.js";import{showToast}from"../utils/toast.js";export async function loadContent(){const e=document.getElementById("content");if(e)try{e.innerHTML='\n      <div class="max-w-7xl mx-auto px-4">\n        <h1 class="text-3xl font-bold mb-6">Tribes</h1>\n        <div class="bg-gray-800/50 p-6 rounded-lg mb-8">\n          <p class="text-lg">Tribes are groups of avatars that share the same emoji identifier. Each tribe has its own characteristics and traits.</p>\n        </div>\n        \n        <div id="tribes-loader" class="flex justify-center py-12">\n          <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"></div>\n        </div>\n        \n        <div id="tribes-content" class="hidden">\n          <div id="tribes-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>\n        </div>\n        \n        <div id="tribe-details" class="hidden mt-8">\n          <button \n            id="back-to-tribes" \n            class="flex items-center gap-2 bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded mb-6 transition-colors"\n          >\n            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />\n            </svg>\n            Back to tribes\n          </button>\n          \n          <div class="flex items-center gap-4 mb-6">\n            <div id="tribe-emoji" class="text-5xl"></div>\n            <h2 class="text-3xl font-bold">Tribe <span id="tribe-name"></span></h2>\n          </div>\n          \n          <div id="tribe-members" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>\n        </div>\n      </div>\n    ';const t=await TribesAPI.getCounts(),n=document.getElementById("tribes-loader"),i=document.getElementById("tribes-content"),r=document.getElementById("tribes-grid"),s=document.getElementById("tribe-details");if(!t||0===t.length)return void renderEmptyState(n);renderTribesGrid(r,t),n.classList.add("hidden"),i.classList.remove("hidden"),document.getElementById("back-to-tribes").addEventListener("click",(()=>{i.classList.remove("hidden"),s.classList.add("hidden")})),window.showTribeDetailsContent=showTribeDetailsContent}catch(t){console.error("Load Tribes error:",t),e.innerHTML=`\n      <div class="text-center py-12 text-red-500">\n        Failed to load tribes: ${t.message}\n        <button \n          class="block mx-auto mt-4 px-4 py-2 bg-gray-700 rounded"\n          onclick="loadContent()"\n        >\n          Retry\n        </button>\n      </div>\n    `}}function renderEmptyState(e){e.innerHTML='<div class="text-center text-gray-400">No tribes found</div>'}function renderTribesGrid(e,t){e.innerHTML=t.map((e=>`\n    <div \n      class="tribe-card bg-gray-800 rounded-lg p-5 flex flex-col items-center hover:bg-gray-700 transition-colors cursor-pointer"\n      data-emoji="${e.emoji}" \n      onclick="showTribeDetailsContent('${e.emoji}')"\n    >\n      <div class="text-5xl mb-3">${e.emoji}</div>\n      <div class="text-xl font-bold">Tribe ${e.emoji}</div>\n      <div class="text-gray-400 mt-2">\n        ${e.count} ${1===e.count?"member":"members"}\n      </div>\n    </div>\n  `)).join("")}export async function showTribeDetailsContent(e){try{const t=document.getElementById("tribes-content"),n=document.getElementById("tribe-details"),i=document.getElementById("tribe-emoji"),r=document.getElementById("tribe-name"),s=document.getElementById("tribe-members");t.classList.add("hidden"),n.classList.remove("hidden"),i.textContent=e,r.textContent=e,s.innerHTML='\n      <div class="col-span-full flex justify-center py-8">\n        <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600"></div>\n      </div>\n    ';const d=await TribesAPI.getTribeByEmoji(e);if(!d||!d.members||0===d.members.length)return void(s.innerHTML='\n        <div class="col-span-full text-center text-gray-400 py-8">\n          No members found for this tribe\n        </div>\n      ');renderTribeMembers(s,d.members,e)}catch(t){console.error("Show Tribe Details error:",t),document.getElementById("tribe-members").innerHTML=`\n      <div class="col-span-full text-center text-red-500 py-8">\n        Failed to load tribe members: ${t.message}\n        <button \n          class="block mx-auto mt-4 px-4 py-2 bg-gray-700 rounded"\n          onclick="showTribeDetailsContent('${e}')"\n        >\n          Retry\n        </button>\n      </div>\n    `}}function renderTribeMembers(e,t,n){e.innerHTML=t.map((e=>{const t=e.name||"Unknown",i=t.charAt(0).toUpperCase();return`\n      <div \n        class="bg-gray-800 p-3 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer"\n        onclick="showAvatarDetails('${e._id}')"\n      >\n        <div class="flex items-center gap-3">\n          ${e.imageUrl?`<img \n                  src="${e.imageUrl}" \n                  alt="${t}" \n                  class="w-16 h-16 object-cover rounded-full"\n                  onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'100\\' height=\\'100\\' viewBox=\\'0 0 100 100\\'%3E%3Crect fill=\\'%23333\\' width=\\'100\\' height=\\'100\\'/%3E%3Ctext fill=\\'%23FFF\\' x=\\'50\\' y=\\'50\\' font-size=\\'50\\' text-anchor=\\'middle\\' dominant-baseline=\\'middle\\'%3E${i}%3C/text%3E%3C/svg%3E';">`:`<div class="w-16 h-16 rounded-full bg-gray-700 flex items-center justify-center text-2xl font-bold text-white">\n                  ${i}\n              </div>`}\n        \n          <div class="flex-1 min-w-0">\n            <h3 class="text-lg font-semibold truncate">${t}</h3>\n            <div class="text-xs text-gray-400 mt-1">\n              ${e.messageCount||0} messages\n            </div>\n          </div>\n        \n          <div class="text-xl">${n}</div>\n        </div>\n      </div>\n    `})).join("")}