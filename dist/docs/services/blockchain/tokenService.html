
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Token Service - CosyWorld Documentation</title>
  <!-- Mermaid script for diagram rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      mermaid.initialize({ 
        startOnLoad: true,
        theme: 'dark',
        securityLevel: 'loose'
      });
    });
  </script>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
      line-height: 1.6;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
      display: flex;
    }
    nav {
      width: 250px;
      padding-right: 2rem;
      flex-shrink: 0;
    }
    main {
      flex-grow: 1;
    }
    code {
      background: #f5f5f5;
      padding: 0.2em 0.4em;
      border-radius: 3px;
      font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      font-size: 85%;
    }
    pre {
      background: #f5f5f5;
      padding: 1rem;
      border-radius: 5px;
      overflow: auto;
    }
    pre code {
      background: none;
      padding: 0;
    }
    a { color: #0366d6; text-decoration: none; }
    a:hover { text-decoration: underline; }
    h1, h2, h3, h4 { margin-top: 1.5em; margin-bottom: 0.5em; }
    h1 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
    nav ul { list-style-type: none; padding-left: 1.2em; }
    nav > ul { padding-left: 0; }
    .section-title { 
      font-weight: bold; 
      margin-top: 1em;
      color: #24292e;
    }
    /* Mermaid diagram styling */
    .mermaid {
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <nav><ul><li><a href="../../index.html">Home</a></li><li><span class="section-title">Overview</span><ul><li><a href="../../overview/03-system-diagram.html">System Diagram</a></li><li><a href="../../overview/02-system-overview.html">System Overview</a></li><li><a href="../../overview/01-introduction.html">CosyWorld Introduction</a></li></ul></li><li><span class="section-title">Systems</span><ul><li><a href="../../systems/06-rati-avatar-system.html">RATi Avatar System</a></li><li><a href="../../systems/05-intelligence-system.html">Intelligence System</a></li><li><a href="../../systems/04-action-system.html">Action System</a></li></ul></li><li><span class="section-title">Services</span><ul><li><a href="../../services/x-authentication.html">X (Twitter) Authentication and Integration</a></li><li><a href="../../services/architecture-report.html">CosyWorld Architecture Report</a></li><li><a href="../../services/README.html">CosyWorld Services Documentation</a></li><li><span class="section-title">World</span><ul><li><a href="../../services/world/questGeneratorService.html">Quest Generator Service</a></li><li><a href="../../services/world/locationService.html">Location Service</a></li><li><a href="../../services/world/itemService.html">Item Service</a></li></ul></li><li><span class="section-title">Web</span><ul><li><a href="../../services/web/webService.html">Web Service</a></li></ul></li><li><span class="section-title">Tools</span><ul><li><a href="../../services/tools/toolService.html">Tool Service</a></li></ul></li><li><span class="section-title">Social</span><ul><li><a href="../../services/social/x-integration.html">X (Twitter) Integration</a></li><li><a href="../../services/social/telegram-integration.html">Telegram Integration (Coming Soon)</a></li><li><a href="../../services/social/discord-integration.html">Discord Integration</a></li><li><a href="../../services/social/README.html">Social Integrations</a></li></ul></li><li><span class="section-title">S3</span><ul><li><a href="../../services/s3/s3Service.html">S3 Service</a></li></ul></li><li><span class="section-title">Quest</span><ul><li><a href="../../services/quest/questGeneratorService.html">Quest Generator Service</a></li></ul></li><li><span class="section-title">Media</span><ul><li><a href="../../services/media/s3Service.html">S3 Service</a></li><li><a href="../../services/media/imageProcessingService.html">Image Processing Service</a></li></ul></li><li><span class="section-title">Location</span><ul><li><a href="../../services/location/locationService.html">Location Service</a></li></ul></li><li><span class="section-title">Item</span><ul><li><a href="../../services/item/itemService.html">Item Service</a></li></ul></li><li><span class="section-title">Integration</span><ul><li><a href="../../services/integration/x-authentication.html">X (Twitter) Authentication and Integration</a></li></ul></li><li><span class="section-title">Foundation</span><ul><li><a href="../../services/foundation/logger.html">Logger Service</a></li><li><a href="../../services/foundation/databaseService.html">Database Service</a></li><li><a href="../../services/foundation/configService.html">Config Service</a></li><li><a href="../../services/foundation/basicService.html">Basic Service</a></li></ul></li><li><span class="section-title">Entity</span><ul><li><a href="../../services/entity/memoryService.html">Memory Service</a></li><li><a href="../../services/entity/avatarService.html">Avatar Service</a></li></ul></li><li><span class="section-title">Core</span><ul><li><a href="../../services/core/promptService.html">Prompt Service</a></li><li><a href="../../services/core/memoryService.html">Memory Service</a></li><li><a href="../../services/core/databaseService.html">Database Service</a></li><li><a href="../../services/core/basicService.html">Basic Service</a></li><li><a href="../../services/core/avatarService.html">Avatar Service</a></li><li><a href="../../services/core/aiService.html">AI Service</a></li></ul></li><li><span class="section-title">Communication</span><ul><li><a href="../../services/communication/conversationManager.html">Conversation Manager</a></li></ul></li><li><span class="section-title">Chat</span><ul><li><a href="../../services/chat/conversationManager.html">Conversation Manager</a></li></ul></li><li><span class="section-title">Blockchain</span><ul><li><a href="../../services/blockchain/tokenService.html">Token Service</a></li></ul></li><li><span class="section-title">Ai</span><ul><li><a href="../../services/ai/replicateService.html">Replicate Service</a></li><li><a href="../../services/ai/promptService.html">Prompt Service</a></li><li><a href="../../services/ai/openrouterAIService.html">OpenRouter AI Service</a></li><li><a href="../../services/ai/ollamaService.html">Ollama Service</a></li><li><a href="../../services/ai/googleAIService.html">Google AI Service</a></li><li><a href="../../services/ai/aiService.html">AI Service</a></li></ul></li></ul></li><li><span class="section-title">Deployment</span><ul><li><a href="../../deployment/08-future-work.html">Future Work Priorities</a></li><li><a href="../../deployment/07-deployment.html">Deployment Guide</a></li></ul></li></ul></nav>
  <main><h1>Token Service</h1>
<h2>Overview</h2>
<p>The Token Service provides a complete interface for creating and managing blockchain tokens on the Solana network. It integrates with the Moonshot SDK to facilitate token creation, transaction management, and wallet interactions, abstracting away the complexities of blockchain development.</p>
<h2>Functionality</h2>
<ul>
<li><strong>Token Creation</strong>: Generates new tokens with customizable parameters (name, symbol, description, icons)</li>
<li><strong>Transaction Preparation</strong>: Creates and prepares mint transactions for user signing</li>
<li><strong>Transaction Submission</strong>: Submits signed transactions to the blockchain</li>
<li><strong>Parameter Validation</strong>: Ensures all token parameters meet platform requirements</li>
<li><strong>Error Handling</strong>: Robust error handling for blockchain interactions</li>
</ul>
<h2>Implementation</h2>
<p>The service implements a facade pattern over the Moonshot SDK, providing a simplified interface for token operations. It initializes with the appropriate blockchain environment based on configuration settings:</p>
<pre><code class="language-javascript">export class TokenService {
  constructor() {
    this.rpcUrl = process.env.SOLANA_RPC_URL || 'https://api.devnet.solana.com';
    this.moonshot = new Moonshot({
      rpcUrl: this.rpcUrl,
      environment: Environment.DEVNET,
      chainOptions: {
        solana: { confirmOptions: { commitment: 'confirmed' } },
      },
    });
  }
}
</code></pre>
<h3>Token Creation Process</h3>
<p>The token creation follows a two-step process:</p>
<ol>
<li>
<p><strong>Prepare Mint</strong>: Sets up the token parameters and prepares the transaction</p>
<pre><code class="language-javascript">async createToken({ name, symbol, description, icon, banner, walletAddress }) {
  // Validate parameters
  if (!name || !symbol || !description || !icon || !banner || !walletAddress) {
    throw new Error('Missing required token parameters');
  }
  
  // Normalize symbol
  symbol = symbol.substring(0, 4).toUpperCase();
  
  // Prepare mint params
  const mintParams = {
    creator: walletAddress,
    name,
    symbol,
    curveType: CurveType.CONSTANT_PRODUCT_V1,
    migrationDex: MigrationDex.RAYDIUM,
    icon,
    description,
    links: [{ url: 'https://www.moonstone-sanctum.com', label: 'Website' }],
    banner,
    tokenAmount: '42000000000',
  };
  
  const prepMint = await this.moonshot.prepareMintTx(mintParams);
  return prepMint;
}
</code></pre>
</li>
<li>
<p><strong>Submit Signed Transaction</strong>: After user signing, submit the transaction to the network</p>
<pre><code class="language-javascript">async submitSignedTransaction(signedTx, tokenId) {
  const res = await this.moonshot.submitMintTx({
    tokenId,
    signedTransaction: signedTx
  });
  return res;
}
</code></pre>
</li>
</ol>
<h2>Dependencies</h2>
<ul>
<li><strong>Moonshot SDK</strong>: External dependency for Solana token operations</li>
<li><strong>Environment Variables</strong>:
<ul>
<li><code>SOLANA_RPC_URL</code>: URL for the Solana network RPC endpoint</li>
</ul>
</li>
<li><strong>Solana Web3.js</strong>: For blockchain interactions</li>
</ul>
<h2>Integration</h2>
<p>The TokenService integrates with other system components:</p>
<ol>
<li><strong>Web Routes</strong>: Exposed through the web service for frontend interaction</li>
<li><strong>Avatar Service</strong>: For associating tokens with avatars</li>
<li><strong>Web3 Wallet</strong>: For transaction signing by users</li>
</ol>
<h2>Usage Examples</h2>
<h3>Creating a New Token</h3>
<pre><code class="language-javascript">// In a web route or other service
const tokenService = new TokenService();

// Step 1: Prepare the token
const tokenPrep = await tokenService.createToken({
  name: &quot;Moonstone&quot;,
  symbol: &quot;MOON&quot;,
  description: &quot;The official token for Moonstone Sanctum&quot;,
  icon: &quot;https://example.com/icon.png&quot;,
  banner: &quot;https://example.com/banner.png&quot;,
  walletAddress: &quot;8dHEEnEajfcgRRb2KfYAqjLrc1EceBe3YfKUEn1WcJCX&quot;
});

// Returns token data including tokenId for the client to sign
// Frontend handles signing process

// Step 2: Submit signed transaction
const result = await tokenService.submitSignedTransaction(
  signedTransactionBase64,
  tokenPrep.tokenId
);
</code></pre>
<h2>Error Handling</h2>
<p>The service implements comprehensive error handling with informative messages:</p>
<pre><code class="language-javascript">try {
  // Token operation
} catch (error) {
  console.error('Error creating token:', {
    error: error.message,
    stack: error.stack,
    name: error.name
  });
  
  if (error.response) {
    console.error('API Response:', {
      status: error.response.status,
      data: error.response.data
    });
  }
  
  throw new Error(`Failed to create token: ${error.message}`);
}
</code></pre>
<h2>Future Improvements</h2>
<h3>Enhanced Token Features</h3>
<ul>
<li>Add support for custom token metadata</li>
<li>Implement token transfer functionality</li>
<li>Add token balance checking capabilities</li>
</ul>
<h3>Security Enhancements</h3>
<ul>
<li>Add signature verification for token operations</li>
<li>Implement rate limiting for token creation</li>
<li>Add additional validation for token parameters</li>
</ul>
<h3>Monitoring and Analytics</h3>
<ul>
<li>Add token creation and transaction monitoring</li>
<li>Implement analytics for token usage and distribution</li>
</ul>
</main>
</body>
</html>
