
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Item Service - CosyWorld Documentation</title>
  <!-- Mermaid script for diagram rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      mermaid.initialize({ 
        startOnLoad: true,
        theme: 'dark',
        securityLevel: 'loose'
      });
    });
  </script>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
      line-height: 1.6;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
      display: flex;
    }
    nav {
      width: 250px;
      padding-right: 2rem;
      flex-shrink: 0;
    }
    main {
      flex-grow: 1;
    }
    code {
      background: #f5f5f5;
      padding: 0.2em 0.4em;
      border-radius: 3px;
      font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      font-size: 85%;
    }
    pre {
      background: #f5f5f5;
      padding: 1rem;
      border-radius: 5px;
      overflow: auto;
    }
    pre code {
      background: none;
      padding: 0;
    }
    a { color: #0366d6; text-decoration: none; }
    a:hover { text-decoration: underline; }
    h1, h2, h3, h4 { margin-top: 1.5em; margin-bottom: 0.5em; }
    h1 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
    nav ul { list-style-type: none; padding-left: 1.2em; }
    nav > ul { padding-left: 0; }
    .section-title { 
      font-weight: bold; 
      margin-top: 1em;
      color: #24292e;
    }
    /* Mermaid diagram styling */
    .mermaid {
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <nav><ul><li><a href="../../index.html">Home</a></li><li><span class="section-title">Overview</span><ul><li><a href="../../overview/03-system-diagram.html">System Diagram</a></li><li><a href="../../overview/02-system-overview.html">CosyWorld System Overview</a></li><li><a href="../../overview/01-introduction.html">CosyWorld Introduction</a></li></ul></li><li><span class="section-title">Systems</span><ul><li><a href="../../systems/06-rati-avatar-system.html">RATi Avatar System</a></li><li><a href="../../systems/05-intelligence-system.html">Intelligence System</a></li><li><a href="../../systems/04-action-system.html">Action System</a></li></ul></li><li><span class="section-title">Services</span><ul><li><a href="../../services/x-authentication.html">X (Twitter) Authentication and Integration</a></li><li><a href="../../services/architecture-report.html">CosyWorld Architecture Report</a></li><li><span class="section-title">World</span><ul><li><a href="../../services/world/questGeneratorService.html">Quest Generator Service</a></li><li><a href="../../services/world/locationService.html">Location Service</a></li><li><a href="../../services/world/itemService.html">Item Service</a></li></ul></li><li><span class="section-title">Web</span><ul><li><a href="../../services/web/webService.html">Web Service</a></li></ul></li><li><span class="section-title">Tools</span><ul><li><a href="../../services/tools/toolService.html">Tool Service</a></li></ul></li><li><span class="section-title">Social</span><ul><li><a href="../../services/social/x-integration.html">X (Twitter) Integration</a></li><li><a href="../../services/social/telegram-integration.html">Telegram Integration (Coming Soon)</a></li><li><a href="../../services/social/discord-integration.html">Discord Integration</a></li></ul></li><li><span class="section-title">S3</span><ul><li><a href="../../services/s3/s3Service.html">S3 Service</a></li></ul></li><li><span class="section-title">Quest</span><ul><li><a href="../../services/quest/questGeneratorService.html">Quest Generator Service</a></li></ul></li><li><span class="section-title">Media</span><ul><li><a href="../../services/media/s3Service.html">S3 Service</a></li><li><a href="../../services/media/imageProcessingService.html">Image Processing Service</a></li></ul></li><li><span class="section-title">Location</span><ul><li><a href="../../services/location/locationService.html">Location Service</a></li></ul></li><li><span class="section-title">Item</span><ul><li><a href="../../services/item/itemService.html">Item Service</a></li></ul></li><li><span class="section-title">Integration</span><ul><li><a href="../../services/integration/x-authentication.html">X (Twitter) Authentication and Integration</a></li></ul></li><li><span class="section-title">Foundation</span><ul><li><a href="../../services/foundation/logger.html">Logger Service</a></li><li><a href="../../services/foundation/databaseService.html">Database Service</a></li><li><a href="../../services/foundation/configService.html">Config Service</a></li><li><a href="../../services/foundation/basicService.html">Basic Service</a></li></ul></li><li><span class="section-title">Entity</span><ul><li><a href="../../services/entity/memoryService.html">Memory Service</a></li><li><a href="../../services/entity/avatarService.html">Avatar Service</a></li></ul></li><li><span class="section-title">Core</span><ul><li><a href="../../services/core/promptService.html">Prompt Service</a></li><li><a href="../../services/core/memoryService.html">Memory Service</a></li><li><a href="../../services/core/databaseService.html">Database Service</a></li><li><a href="../../services/core/basicService.html">Basic Service</a></li><li><a href="../../services/core/avatarService.html">Avatar Service</a></li><li><a href="../../services/core/aiService.html">AI Service</a></li></ul></li><li><span class="section-title">Communication</span><ul><li><a href="../../services/communication/conversationManager.html">Conversation Manager</a></li></ul></li><li><span class="section-title">Chat</span><ul><li><a href="../../services/chat/conversationManager.html">Conversation Manager</a></li></ul></li><li><span class="section-title">Blockchain</span><ul><li><a href="../../services/blockchain/tokenService.html">Token Service</a></li></ul></li><li><span class="section-title">Ai</span><ul><li><a href="../../services/ai/replicateService.html">Replicate Service</a></li><li><a href="../../services/ai/promptService.html">Prompt Service</a></li><li><a href="../../services/ai/openrouterAIService.html">OpenRouter AI Service</a></li><li><a href="../../services/ai/ollamaService.html">Ollama Service</a></li><li><a href="../../services/ai/googleAIService.html">Google AI Service</a></li><li><a href="../../services/ai/aiService.html">AI Service</a></li></ul></li></ul></li><li><span class="section-title">Deployment</span><ul><li><a href="../../deployment/08-future-work.html">Future Work Priorities</a></li><li><a href="../../deployment/07-deployment.html">CosyWorld Deployment Guide</a></li></ul></li></ul></nav>
  <main><h1>Item Service</h1>
<h2>Overview</h2>
<p>The ItemService manages the creation, storage, retrieval, and interaction of items within the RATi Avatar System. It implements the RATi NFT Metadata Standard for items, enabling them to exist as on-chain assets with autonomous behaviors and effects. Items can be traded, used, combined, and evolve through interactions with avatars and environments.</p>
<h2>Functionality</h2>
<ul>
<li><strong>Item Creation</strong>: Generates new items with AI-driven properties and RATi-compliant metadata</li>
<li><strong>Inventory Management</strong>: Tracks item ownership and transfers across wallets and platforms</li>
<li><strong>Item Retrieval</strong>: Provides methods to find and access items by various criteria</li>
<li><strong>Item Interactions</strong>: Handles using, combining, and affecting items with autonomous behaviors</li>
<li><strong>Item Evolution</strong>: Manages the burn-to-upgrade process for items</li>
<li><strong>Blockchain Integration</strong>: Supports on-chain verification and persistent storage</li>
</ul>
<h2>Implementation</h2>
<p>The ItemService extends BasicService and uses both database and blockchain storage to persist item information. It interfaces with AI services to generate item descriptions and behaviors.</p>
<pre><code class="language-javascript">export class ItemService extends BasicService {
  constructor(services) {
    super(services, [
      'databaseService',
      'aiService',
      'configService',
      'arweaveService',
      'nftMintService',
    ]);
    
    this.db = this.databaseService.getDatabase();
    
    // Additional initialization...
  }
  
  // Methods...
}
</code></pre>
<h3>Key Methods</h3>
<h4><code>createItem(data)</code></h4>
<p>Creates a new item with RATi-compliant metadata, generating missing fields with AI services.</p>
<h4><code>getItemById(itemId)</code></h4>
<p>Retrieves an item from the database by its ID, with optional blockchain verification.</p>
<h4><code>searchItems(locationId, searchTerm)</code></h4>
<p>Finds items in a specific location, optionally filtered by search term.</p>
<h4><code>addItemToInventory(avatarId, itemId)</code></h4>
<p>Transfers an item to an avatar’s inventory, updating both database and blockchain records.</p>
<h4><code>removeItemFromInventory(avatarId, itemId)</code></h4>
<p>Removes an item from an avatar’s inventory, updating records accordingly.</p>
<h4><code>useItem(avatarId, itemId, targetId = null)</code></h4>
<p>Processes the usage of an item, potentially affecting the target and triggering autonomous behaviors.</p>
<h4><code>generateItemResponse(item, channelId)</code></h4>
<p>Uses AI to generate a “response” from an item as if it were speaking, based on its metadata attributes.</p>
<h4><code>updateArweaveMetadata(item)</code></h4>
<p>Updates permanent storage with current item data for blockchain integration.</p>
<h4><code>mintNFTFromItem(item, walletAddress)</code></h4>
<p>Creates an on-chain NFT representation of an item following the RATi NFT Metadata Standard.</p>
<h4><code>evolveItem(itemIds, walletAddress)</code></h4>
<p>Implements the burn-to-upgrade process for evolving items by combining multiple source items.</p>
<h2>RATi NFT Metadata Integration</h2>
<p>Items implement the RATi NFT Metadata Standard with these mappings:</p>
<pre><code class="language-javascript">// Standard RATi metadata for items
const ratiMetadata = {
  tokenId: item._id.toString(),
  name: item.name,
  description: item.description,
  media: {
    image: item.imageUrl
  },
  attributes: [
    { trait_type: &quot;Type&quot;, value: item.type },
    { trait_type: &quot;Rarity&quot;, value: item.rarity },
    { trait_type: &quot;Effect&quot;, value: item.effect || &quot;None&quot; }
  ],
  storage: {
    primary: item.arweaveId ? `ar://${item.arweaveId}` : null,
    backup: item.ipfsId ? `ipfs://${item.ipfsId}` : null
  },
  evolution: {
    level: item.evolutionLevel || 1,
    previous: item.sourceItemIds || [],
    timestamp: item.updatedAt.toISOString()
  },
  memory: {
    recent: item.interactionArweaveId ? `ar://${item.interactionArweaveId}` : null,
    archive: null
  }
};
</code></pre>
<h2>Item Schema</h2>
<p>Items follow a standardized schema that extends the RATi NFT Metadata Standard:</p>
<h3>Core Identity</h3>
<ul>
<li><code>name</code>: The item’s name</li>
<li><code>description</code>: Detailed description of appearance and properties</li>
<li><code>type</code>: Item category (weapon, tool, artifact, etc.)</li>
<li><code>rarity</code>: How rare/valuable the item is (common, uncommon, rare, legendary)</li>
<li><code>imageUrl</code>: Visual representation</li>
<li><code>arweaveId</code>: Permanent storage identifier</li>
<li><code>tokenId</code>: On-chain NFT identifier (when minted)</li>
</ul>
<h3>Properties and Effects</h3>
<ul>
<li><code>properties</code>: Special attributes and effects object</li>
<li><code>effect</code>: Primary effect description</li>
<li><code>usageCount</code>: Number of times the item has been used</li>
<li><code>durability</code>: Current durability status</li>
<li><code>cooldown</code>: Timestamp for next available use</li>
</ul>
<h3>Ownership and Location</h3>
<ul>
<li><code>ownerId</code>: Current owner (avatar ID or wallet address)</li>
<li><code>locationId</code>: Current location if not in inventory</li>
<li><code>transferable</code>: Whether the item can be traded</li>
<li><code>bound</code>: Whether the item is soul-bound to its owner</li>
</ul>
<h3>Evolution and Crafting</h3>
<ul>
<li><code>evolutionLevel</code>: Current upgrade level</li>
<li><code>sourceItemIds</code>: Array of items used to create this item</li>
<li><code>craftingRecipe</code>: Requirements for using in evolution</li>
<li><code>ingredientFor</code>: Items this can help create</li>
</ul>
<h2>Item Types and Effects</h2>
<p>The service supports different categories of items:</p>
<h3>Equipment</h3>
<ul>
<li>Wearable items that provide passive benefits</li>
<li>Affects avatar appearance and capabilities</li>
<li>Can be equipped in specific slots</li>
<li>May have durability limitations</li>
</ul>
<h3>Consumables</h3>
<ul>
<li>One-time or limited-use items</li>
<li>Provides immediate effects when used</li>
<li>May restore avatar resources</li>
<li>Often used as crafting ingredients</li>
</ul>
<h3>Artifacts</h3>
<ul>
<li>Unique special items with powerful effects</li>
<li>Often triggers location or story events</li>
<li>May have autonomous behaviors</li>
<li>Usually non-transferable or rare</li>
</ul>
<h3>Key Items</h3>
<ul>
<li>Progression-related items</li>
<li>Unlocks locations or abilities</li>
<li>Often part of quest chains</li>
<li>Typically non-consumable</li>
</ul>
<h2>Autonomous Behaviors</h2>
<p>Items can exhibit autonomous behaviors based on:</p>
<ul>
<li><strong>Rarity Tier</strong>: Higher rarity enables more complex behaviors</li>
<li><strong>Type Properties</strong>: Different categories have specific action patterns</li>
<li><strong>Environmental Context</strong>: Responds differently based on location</li>
<li><strong>Interaction History</strong>: Adapts based on previous uses</li>
<li><strong>Owner Relationship</strong>: Personalized behaviors for long-term owners</li>
</ul>
<h2>Dependencies</h2>
<ul>
<li>DatabaseService: For traditional persistence of item data</li>
<li>AIService: For generating item descriptions and behaviors</li>
<li>ArweaveService: For permanent metadata storage</li>
<li>NFTMintService: For on-chain item minting</li>
<li>ConfigService: For item-related settings and rules</li>
</ul>
<h2>Blockchain Integration</h2>
<p>The ItemService provides several blockchain-related features:</p>
<ul>
<li><strong>NFT Minting</strong>: Creation of on-chain item representations</li>
<li><strong>Metadata Storage</strong>: Permanent recording of item properties on Arweave</li>
<li><strong>Transfer Verification</strong>: Ensuring legitimate ownership transitions</li>
<li><strong>Evolution Processing</strong>: Implementing the burn-to-upgrade process</li>
<li><strong>Cross-Platform Consistency</strong>: Maintaining consistent representation across platforms</li>
</ul>
</main>
</body>
</html>
